# Log Classification Project

![pandas](https://img.shields.io/badge/pandas-2.2.2-blue?logo=pandas) ![python-dotenv](https://img.shields.io/badge/python--dotenv-1.0.1-green) ![groq](https://img.shields.io/badge/groq-0.7.0-orange) ![sentence-transformers](https://img.shields.io/badge/sentence--transformers-2.6.1-purple) ![Llama](https://img.shields.io/badge/Llama-3.3--70b--versatile-9cf?logo=llama) ![scikit-learn](https://img.shields.io/badge/scikit--learn-1.4.2-yellow?logo=scikit-learn) ![joblib](https://img.shields.io/badge/joblib-1.4.2-lightgrey) ![FastAPI](https://img.shields.io/badge/FastAPI-0.115.x-teal?logo=fastapi) ![uvicorn](https://img.shields.io/badge/uvicorn-0.30.x-black)

This project classifies log messages from various systems using a combination of **regex**, **BERT embeddings**, and an **LLM (Groq API)**.  
Results can be generated by a Python script **or** through a **FastAPI web service**.

## Features
* **Regex-based classification** for common log patterns.
* **BERT-based classification** for semantic understanding.
* **LLM-based classification** (Groq API) for complex LegacyCRM logs.
* Easy CSV input/output for batch processing.
* **FastAPI REST endpoint** to classify logs through HTTP.

## File Structure
```
.
├─ classify.py                # Main script for direct CLI usage
├─ server.py                  # FastAPI application
├─ processor_regex.py         # Regex-based classifier
├─ processor_bert.py          # BERT-based classifier
├─ processor_llm.py           # LLM-based classifier using Groq API
├─ resources/
│   ├─ test.csv               # Example input CSV
│   └─ output.csv             # Classification results
└─ .env                       # Stores GROQ_API_KEY
```

## Installation
```bash
pip install -r requirements.txt
pip install fastapi "uvicorn[standard]" python-multipart
```

## Environment
Create a `.env` file in the project root:
```
GROQ_API_KEY=your_groq_api_key_here
```

## Usage – Command Line
1. Prepare your input CSV in `resources/test.csv` with columns **source** and **log_message**.
2. Run:
```bash
python classify.py
```
3. Results will be written to `resources/output.csv`.

## Usage – FastAPI Service
You can also run the classifier as an HTTP API.

### 1️⃣ Start the server
```bash
uvicorn server:app --reload
```
This starts the API at **http://127.0.0.1:8000/**.

### 2️⃣ API Endpoint
**POST** `/classify/`  
*Form-data* key: `file` (type **File**, value: your CSV).  
Returns: CSV file with an extra column `target_label`.

### 3️⃣ Test from command line
```bash
curl -F "file=@resources/test.csv" http://127.0.0.1:8000/classify/ -o classified.csv
```

### 4️⃣ Swagger UI
Visit **http://127.0.0.1:8000/docs** to upload a CSV and see the API documentation interactively.

## Example
**Input (`resources/test.csv`):**
| source        | log_message                                                    |
|---------------|-----------------------------------------------------------------|
| ModernCRM     | IP 192.168.133.114 blocked due to potential attack             |
| BillingSystem | User user12345 logged in.                                      |
| LegacyCRM     | Case escalation for ticket ID 7324 failed because ...          |

**Output (`resources/output.csv`):**
| source        | log_message                                                    | target_label     |
|---------------|-----------------------------------------------------------------|------------------|
| ModernCRM     | IP 192.168.133.114 blocked due to potential attack             | Security Alert   |
| BillingSystem | User user12345 logged in.                                      | User Action      |
| LegacyCRM     | Case escalation for ticket ID 7324 failed because ...          | Workflow Error   |

## Notes
* For LLM classification ensure your Groq API key is valid and `.env` is present.
* Customize regex patterns or model logic inside the processor files.

## Requirements
See `requirements.txt` for the full dependency list.
